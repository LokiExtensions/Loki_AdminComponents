<?php
declare(strict_types=1);

/** @version 0.6.1 */

use Magento\Framework\Escaper;
use Magento\Framework\View\Element\Template;
use Loki\AdminComponents\Component\Grid\GridViewModel;
use Loki\Components\Util\Block\TemplateRenderer;

/** @var Template $block */
/** @var GridViewModel $viewModel */
/** @var Escaper $escaper */
/** @var TemplateRenderer $templateRenderer */

$viewModel = $block->getViewModel();
$gridFilters = $viewModel->getGridFilters();
$gridFilterStates = $viewModel->getGridFilterStates();

if (empty($gridFilters)) {
    return;
}
?>
<div class="data-grid-filters-actions-wrap">
    <div class="data-grid-filters-action-wrap">
        <button :class="filterButtonClass" class="action-default" @click="toggleFilters">
            Filters
        </button>
    </div>
</div>

<?php if (!empty($gridFilterStates)): ?>
<div class="admin__data-grid-filters-current _show">
    <div class="admin__current-filters-title-wrap">
        <span class="admin__current-filters-title">
            <?= $escaper->escapeHtml(__('Active filters:')) ?>
        </span>
    </div>
    <div class="admin__current-filters-list-wrap">
        <ul class="admin__current-filters-list" data-role="filter-list">
            <?php foreach ($gridFilterStates as $gridFilterState): ?>
            <li>
                <span class="label"><?= $escaper->escapeHtml($gridFilterState->getField()) ?></span>
                <span class="condition-type"><?= $escaper->escapeHtml($gridFilterState->getConditionType()) ?></span>
                <span class="preview"><?= $escaper->escapeHtml($gridFilterState->renderValue()) ?></span>

                <button class="action-remove" type="button" @click="removeFilter" data-field="<?= $escaper->escapeHtml($gridFilterState->getField()) ?>">
                    <span><?= $escaper->escapeHtml(__('Remove')) ?></span>
                </button>
            </li>
            <?php endforeach; ?>
        </ul>
    </div>
</div>
<?php endif; ?>

<div x-cloak x-show="showFilters" class="admin__data-grid-filters-wrap _show">
    <fieldset class="admin__fieldset admin__data-grid-filters">
        <?php foreach ($gridFilters as $gridFilter): ?>
            <fieldset class="admin__form-field">
                <?= /* @noEscape */ $gridFilter->render(); ?>
            </fieldset>
        <?php endforeach; ?>
    </fieldset>

    <div class="admin__data-grid-filters-footer">
        <div class="admin__footer-main-actions">
            <?php if (!empty($gridFilterStates)): ?>
            <button class="action-tertiary" type="button" @click="clearFilters">
                <span><?= $escaper->escapeHtml(__('Clear all')) ?></span>
            </button>
            <?php endif; ?>

            <button class="action-tertiary" type="button" data-action="grid-filter-cancel" @click="toggleFilters">
                <span><?= $escaper->escapeHtml(__('Cancel')) ?></span>
            </button>

            <button class="action-secondary" type="button" data-action="grid-filter-apply" @click="applyFilters">
                <span><?= $escaper->escapeHtml(__('Apply Filters')) ?></span>
            </button>
        </div>
    </div>
</div>

